@model MyFace.Web.Models.EditProfileViewModel
@using System
@{
    ViewData["Title"] = "Customize My Profile";
    var user = ViewBag.User as MyFace.Core.Entities.User;
    var isPreview = (ViewBag.IsPreview as bool?) ?? false;

    user ??= new MyFace.Core.Entities.User
    {
        Username = User?.Identity?.Name ?? "Your profile",
        BackgroundColor = "#0f172a",
        FontColor = "#e5e7eb",
        AccentColor = "#3b82f6",
        BorderColor = "#334155",
        ButtonBackgroundColor = "#0ea5e9",
        ButtonTextColor = "#ffffff",
        ButtonBorderColor = "#0ea5e9",
        FontFamily = "system-ui, -apple-system, sans-serif",
        ProfileLayout = "default",
        CreatedAt = DateTime.UtcNow
    };

    string AdjustColor(string hex, double factor)
    {
        if (string.IsNullOrWhiteSpace(hex) || !hex.StartsWith("#") || (hex.Length != 7 && hex.Length != 4)) return hex ?? string.Empty;
        string Expand(string h) => h.Length == 4 ? $"#{h[1]}{h[1]}{h[2]}{h[2]}{h[3]}{h[3]}" : h;
        var full = Expand(hex);
        try
        {
            int r = Convert.ToInt32(full.Substring(1, 2), 16);
            int g = Convert.ToInt32(full.Substring(3, 2), 16);
            int b = Convert.ToInt32(full.Substring(5, 2), 16);
            r = Math.Clamp((int)(r * factor), 0, 255);
            g = Math.Clamp((int)(g * factor), 0, 255);
            b = Math.Clamp((int)(b * factor), 0, 255);
            return $"#{r:X2}{g:X2}{b:X2}";
        }
        catch
        {
            return hex;
        }
    }

    var background = string.IsNullOrWhiteSpace(user.BackgroundColor) ? "#0f172a" : user.BackgroundColor;
    var fontColor = string.IsNullOrWhiteSpace(user.FontColor) ? "#e5e7eb" : user.FontColor;
    var accent = string.IsNullOrWhiteSpace(user.AccentColor) ? "#3b82f6" : user.AccentColor;
    var border = string.IsNullOrWhiteSpace(user.BorderColor) ? "#334155" : user.BorderColor;
    var btnBg = string.IsNullOrWhiteSpace(user.ButtonBackgroundColor) ? "#0ea5e9" : user.ButtonBackgroundColor;
    var btnText = string.IsNullOrWhiteSpace(user.ButtonTextColor) ? "#ffffff" : user.ButtonTextColor;
    var btnBorder = string.IsNullOrWhiteSpace(user.ButtonBorderColor) ? btnBg : user.ButtonBorderColor;
    var btnHover = AdjustColor(btnBg, 0.9);
    var btnActive = AdjustColor(btnBg, 0.82);

    var pathChoice = Context.Request.HasFormContentType && Context.Request.Form.ContainsKey("pathChoice")
        ? Context.Request.Form["pathChoice"].ToString()
        : "preset";
    var themePreset = Context.Request.HasFormContentType && Context.Request.Form.ContainsKey("themePreset")
        ? Context.Request.Form["themePreset"].ToString()
        : "midnight";
}

<style>
    .customize-shell { max-width: 1240px; margin: 0 auto; padding: 2rem 1rem 2.5rem; font-family: "Space Grotesk", "Trebuchet MS", "Segoe UI", sans-serif; color: #0f172a; }
    .page-header { display: flex; justify-content: space-between; gap: 1.5rem; align-items: center; }
    .title-block h1 { margin: 0; font-size: 2rem; letter-spacing: -0.01em; }
    .title-block p { margin: 0.4rem 0 0; color: #475569; }
    .badge-row { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.4rem; }
    .chip { padding: 0.35rem 0.65rem; border-radius: 999px; font-size: 0.8rem; border: 1px solid #e2e8f0; background: #f8fafc; color: #0f172a; }
    .chip.live { border-color: #c7d2fe; background: #eef2ff; color: #312e81; }
    .chip.preview { border-color: #fef3c7; background: #fffbeb; color: #92400e; }

    .flow-grid { display: flex; flex-direction: column; gap: 1.25rem; margin-top: 1.5rem; }
    .panel { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; box-shadow: 0 12px 40px rgba(15, 23, 42, 0.08); }
    .panel-inner { padding: 1.5rem; }
    .section-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
    .section-title h3 { margin: 0; font-size: 1.05rem; letter-spacing: -0.01em; }
    .section-note { color: #64748b; font-size: 0.9rem; }

    .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 0.75rem; }
    .select-card { border: 1px solid #e2e8f0; border-radius: 10px; padding: 0.9rem; display: flex; gap: 0.75rem; align-items: center; background: #f8fafc; transition: border-color 120ms ease, box-shadow 120ms ease; }
    .select-card input { margin: 0; }
    .select-card:hover { border-color: #cbd5e1; box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08); }
    .select-card .meta { margin: 0.15rem 0 0; color: #64748b; font-size: 0.9rem; }

    .preset-chip { display: inline-flex; gap: 0.4rem; align-items: center; font-size: 0.85rem; color: #0f172a; }
    .swatch { width: 18px; height: 18px; border-radius: 6px; border: 1px solid #cbd5e1; }

    .field-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 0.9rem; margin-top: 0.75rem; align-items: start; }
    .field-grid.spacious { gap: 1.25rem; }
    .field { display: flex; flex-direction: column; gap: 0.35rem; }
    .field label { font-weight: 600; color: #0f172a; font-size: 0.92rem; }
    .field small { color: #64748b; }
    .text-input, .select-input, .color-input, textarea { width: 100%; padding: 0.65rem 0.75rem; border-radius: 8px; border: 1px solid #cbd5e1; background: #fff; color: #0f172a; font-size: 0.95rem; }
    textarea { min-height: 140px; }
    .textarea-tall { min-height: 180px; }

    .action-row { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 1.25rem; }
    .btn { border: none; border-radius: 10px; padding: 0.8rem 1.2rem; font-weight: 700; letter-spacing: 0.01em; cursor: pointer; transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; }
    .btn.primary { background: #111827; color: #f8fafc; box-shadow: 0 12px 30px rgba(17, 24, 39, 0.15); }
    .btn.accent { background: #0ea5e9; color: #0b1220; box-shadow: 0 12px 30px rgba(14, 165, 233, 0.25); }
    .btn.ghost { background: #f8fafc; color: #0f172a; border: 1px solid #e2e8f0; }
    .btn.link { background: transparent; color: #0f172a; padding-left: 0; padding-right: 0; box-shadow: none; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 14px 34px rgba(15, 23, 42, 0.16); }
    .btn:active { transform: translateY(0); box-shadow: 0 8px 16px rgba(15, 23, 42, 0.18); }

    .preview-card { border-radius: 12px; border: 1px solid #1f2937; padding: 1.25rem; background: var(--preview-bg, #0f172a); color: var(--preview-color, #e5e7eb); box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 18px 40px rgba(0,0,0,0.35); height: 200px; overflow: hidden; }
    .preview-card h3 { margin: 0 0 0.35rem; color: var(--preview-color, #e5e7eb); }
    .preview-card .meta { color: rgba(229, 231, 235, 0.78); font-size: 0.9rem; margin: 0; }
    .preview-buttons { display: flex; gap: 0.6rem; flex-wrap: wrap; margin-top: 1rem; }
    .p-btn { padding: 0.65rem 1rem; border-radius: 10px; border: 1px solid var(--btn-border, #0ea5e9); background: var(--btn-bg, #0ea5e9); color: var(--btn-text, #ffffff); font-weight: 700; letter-spacing: 0.01em; }
    .p-btn.ghost { background: transparent; color: var(--btn-bg, #0ea5e9); }
    .palette-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; margin-top: 0.9rem; }
    .palette-chip { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; padding: 0.5rem; display: flex; align-items: center; gap: 0.45rem; }
    .palette-chip .dot { width: 16px; height: 16px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.15); }

    .aside { display: grid; gap: 1rem; }
    .aside-card { background: #0f172a; color: #e2e8f0; border-radius: 12px; padding: 1.2rem; border: 1px solid #1f2937; box-shadow: 0 12px 30px rgba(15,23,42,0.4); }
    .aside-card h4 { margin: 0 0 0.35rem; color: #f8fafc; }
    .aside-card ul { margin: 0.2rem 0 0; padding-left: 1.1rem; color: #cbd5e1; }

    @@media (max-width: 640px) {
        .page-header { flex-direction: column; align-items: flex-start; }
        .action-row { flex-direction: column; align-items: stretch; }
        .btn { justify-content: center; }
    }
</style>

<div class="customize-shell">
    <div class="page-header">
        <div class="title-block">
            <h1>Guided profile design</h1>
            <p>Pick a lane, choose a palette, and preview without JavaScript.</p>
            <div class="badge-row">
                <span class="chip live">Step-by-step</span>
                <span class="chip">Server-rendered preview</span>
                @if (isPreview)
                {
                    <span class="chip preview">Preview mode</span>
                }
            </div>
        </div>
    </div>

    <div class="flow-grid">
        <div class="panel" style="background: linear-gradient(145deg, #0f172a, #0b1220); color: #e5e7eb;">
            <div class="panel-inner" style="border-radius: 12px;">
                <div class="section-title" style="margin-bottom: 0.5rem;">
                    <h3 style="color: #f8fafc; margin: 0;">Live preview</h3>
                    @if (isPreview)
                    {
                        <span class="chip preview">Preview from server</span>
                    }
                    else
                    {
                        <span class="chip" style="background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.2); color: #e2e8f0;">Current profile</span>
                    }
                </div>

                <div class="preview-card"
                     style="--preview-bg: @background; --preview-color: @fontColor; --preview-accent: @accent; --preview-border: @border; --preview-font: @user.FontFamily; --btn-bg: @btnBg; --btn-text: @btnText; --btn-border: @btnBorder;">
                    <h3>@user.Username</h3>
                    <p class="meta">Member since @user.CreatedAt.ToString("MMMM yyyy")</p>

                    @if (!string.IsNullOrWhiteSpace(user.AboutMe))
                    {
                        <div style="margin: 0.5rem 0 0.35rem; font-size: 0.95rem; line-height: 1.5;">
                            @Html.Raw(new MyFace.Web.Services.BBCodeFormatter().Format(user.AboutMe))
                        </div>
                    }
                    else
                    {
                        <p style="color: rgba(229, 231, 235, 0.85);">Add an About message to see it styled here.</p>
                    }

                    <div class="preview-buttons" style="margin-top: 0.6rem;">
                        <button type="button" class="p-btn">Primary action</button>
                        <button type="button" class="p-btn ghost">Ghost button</button>
                    </div>

                    <div class="palette-row" style="margin-top: 0.6rem;">
                        <div class="palette-chip"><span class="dot" style="background:@background;"></span>Background</div>
                        <div class="palette-chip"><span class="dot" style="background:@fontColor;"></span>Text</div>
                        <div class="palette-chip"><span class="dot" style="background:@accent;"></span>Accent</div>
                        <div class="palette-chip"><span class="dot" style="background:@border;"></span>Border</div>
                        <div class="palette-chip"><span class="dot" style="background:@btnBg;"></span>Button</div>
                    </div>

                    <div style="margin-top: 0.6rem; padding-top: 0.5rem; border-top: 1px solid rgba(255,255,255,0.12);">
                        <h4 style="margin: 0 0 0.25rem; color: #f8fafc;">Vendor snapshot</h4>
                        @if (!string.IsNullOrWhiteSpace(user.VendorShopDescription) || !string.IsNullOrWhiteSpace(user.VendorPolicies) || !string.IsNullOrWhiteSpace(user.VendorPayments))
                        {
                            <div style="display: grid; gap: 0.35rem; color: rgba(229, 231, 235, 0.9);">
                                @if (!string.IsNullOrWhiteSpace(user.VendorShopDescription))
                                {
                                    <div><strong>Shop</strong><br />@Html.Encode(user.VendorShopDescription)</div>
                                }
                                @if (!string.IsNullOrWhiteSpace(user.VendorPolicies))
                                {
                                    <div><strong>Policies</strong><br />@Html.Encode(user.VendorPolicies)</div>
                                }
                                @if (!string.IsNullOrWhiteSpace(user.VendorPayments))
                                {
                                    <div><strong>Payments</strong><br />@Html.Encode(user.VendorPayments)</div>
                                }
                                @if (!string.IsNullOrWhiteSpace(user.VendorExternalReferences))
                                {
                                    <div><strong>External refs</strong><br /><span style="white-space: pre-wrap;">@Html.Encode(user.VendorExternalReferences)</span></div>
                                }
                            </div>
                        }
                        else
                        {
                            <p style="margin: 0; color: rgba(229, 231, 235, 0.75);">Add shop details to preview them.</p>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-inner">
                <form method="post" action="/user/editprofile">
                    @Html.AntiForgeryToken()

                    <div class="section-title">
                        <h3>Choose your own design</h3>
                        <span class="section-note">You can change designs at any time.</span>
                    </div>
                    <div class="card-grid">
                        <label class="select-card">
                            <input type="radio" name="pathChoice" value="preset" @(pathChoice == "preset" ? "checked" : string.Empty) />
                            <div>
                                <strong>Default themes</strong>
                                <p class="meta">Pick a ready-made look and apply instantly.</p>
                            </div>
                        </label>
                        <label class="select-card">
                            <input type="radio" name="pathChoice" value="custom" @(pathChoice == "custom" ? "checked" : string.Empty) />
                            <div>
                                <strong>Custom themes</strong>
                                <p class="meta">Start from a base or go completely custom.</p>
                            </div>
                        </label>
                    </div>

                    @if (pathChoice == "preset")
                    {
                        <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 1.25rem 0;" />

                        <div class="section-title">
                            <h3>Default themes</h3>
                            <span class="section-note">Pick a look and apply; no extra fields.</span>
                        </div>
                        <div class="card-grid">
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="classic-light" @(themePreset == "classic-light" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Classic Light</strong>
                                    <p class="meta">Clean cards with crisp borders.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#f6f7fb;"></span><span class="swatch" style="background:#2f6fe4;"></span><span class="swatch" style="background:#1f2933;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="midnight" @(themePreset == "midnight" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Midnight</strong>
                                    <p class="meta">Moody indigo with violet accents.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0f172a;"></span><span class="swatch" style="background:#8b5cf6;"></span><span class="swatch" style="background:#e5e7eb;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="forest" @(themePreset == "forest" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Forest</strong>
                                    <p class="meta">Earthy contrast with mint highlights.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0f2214;"></span><span class="swatch" style="background:#22c55e;"></span><span class="swatch" style="background:#e3f4e3;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="sunrise" @(themePreset == "sunrise" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Sunrise</strong>
                                    <p class="meta">Warm amber with soft cream.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#2b1b12;"></span><span class="swatch" style="background:#f59e0b;"></span><span class="swatch" style="background:#fef3c7;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="ocean" @(themePreset == "ocean" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Ocean</strong>
                                    <p class="meta">Deep teal with crisp foam.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0b1f2a;"></span><span class="swatch" style="background:#06b6d4;"></span><span class="swatch" style="background:#e0f2fe;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="ember" @(themePreset == "ember" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Ember</strong>
                                    <p class="meta">Charcoal with copper highlights.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#111827;"></span><span class="swatch" style="background:#f97316;"></span><span class="swatch" style="background:#e5e7eb;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="pastel" @(themePreset == "pastel" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Pastel</strong>
                                    <p class="meta">Soft lilac, mint, and cloud.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#f5f3ff;"></span><span class="swatch" style="background:#a5b4fc;"></span><span class="swatch" style="background:#ecfeff;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="slate" @(themePreset == "slate" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Slate</strong>
                                    <p class="meta">Minimal gray with sharp accents.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0f172a;"></span><span class="swatch" style="background:#38bdf8;"></span><span class="swatch" style="background:#e2e8f0;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="mono" @(themePreset == "mono" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Mono</strong>
                                    <p class="meta">High-contrast black and white.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0b0b0f;"></span><span class="swatch" style="background:#f8fafc;"></span><span class="swatch" style="background:#d1d5db;"></span></div>
                                </div>
                            </label>
                        </div>

                        <div class="action-row" style="margin-top: 0.9rem;">
                            <button type="submit" name="applyTheme" value="load" class="btn accent">Apply theme &amp; save</button>
                            <button type="submit" name="applyTheme" value="load" formaction="/user/editprofile/preview" class="btn ghost">Preview this theme</button>
                        </div>
                    }

                    @if (pathChoice == "custom")
                    {
                        <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 1.25rem 0;" />

                        <div class="section-title">
                            <h3>Custom themes</h3>
                            <span class="section-note">Choose a base or go completely custom.</span>
                        </div>
                        <div class="card-grid">
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="classic-light" @(themePreset == "classic-light" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Classic Light</strong>
                                    <p class="meta">Copy this palette, then tweak it below.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#f6f7fb;"></span><span class="swatch" style="background:#2f6fe4;"></span><span class="swatch" style="background:#1f2933;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="midnight" @(themePreset == "midnight" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Midnight</strong>
                                    <p class="meta">Load dark indigo as your base.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0f172a;"></span><span class="swatch" style="background:#8b5cf6;"></span><span class="swatch" style="background:#e5e7eb;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="forest" @(themePreset == "forest" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Forest</strong>
                                    <p class="meta">Rich greens with mint highlights.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0f2214;"></span><span class="swatch" style="background:#22c55e;"></span><span class="swatch" style="background:#e3f4e3;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="sunrise" @(themePreset == "sunrise" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Sunrise</strong>
                                    <p class="meta">Warm amber with soft cream.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#2b1b12;"></span><span class="swatch" style="background:#f59e0b;"></span><span class="swatch" style="background:#fef3c7;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="ocean" @(themePreset == "ocean" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Ocean</strong>
                                    <p class="meta">Teal depths with pale surf.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0b1f2a;"></span><span class="swatch" style="background:#06b6d4;"></span><span class="swatch" style="background:#e0f2fe;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="ember" @(themePreset == "ember" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Ember</strong>
                                    <p class="meta">Charcoal base with copper pops.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#111827;"></span><span class="swatch" style="background:#f97316;"></span><span class="swatch" style="background:#e5e7eb;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="pastel" @(themePreset == "pastel" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Pastel</strong>
                                    <p class="meta">Soft lilac and mint for calm.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#f5f3ff;"></span><span class="swatch" style="background:#a5b4fc;"></span><span class="swatch" style="background:#ecfeff;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="slate" @(themePreset == "slate" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Slate</strong>
                                    <p class="meta">Minimal, crisp contrast.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0f172a;"></span><span class="swatch" style="background:#38bdf8;"></span><span class="swatch" style="background:#e2e8f0;"></span></div>
                                </div>
                            </label>
                            <label class="select-card">
                                <input type="radio" name="themePreset" value="mono" @(themePreset == "mono" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Start from Mono</strong>
                                    <p class="meta">Black, white, and punchy outlines.</p>
                                    <div class="preset-chip"><span class="swatch" style="background:#0b0b0f;"></span><span class="swatch" style="background:#f8fafc;"></span><span class="swatch" style="background:#d1d5db;"></span></div>
                                </div>
                            </label>
                            <label class="select-card" style="border-style: dashed;">
                                <input type="radio" name="themePreset" value="custom-freeform" @(themePreset == "custom-freeform" ? "checked" : string.Empty) />
                                <div>
                                    <strong>Completely custom</strong>
                                    <p class="meta">Skip presets and design every color yourself.</p>
                                </div>
                            </label>
                        </div>

                        <div class="action-row" style="margin-top: 0.9rem;">
                            <button type="submit" name="applyTheme" value="load" class="btn accent">Load this as my base</button>
                            <button type="submit" name="applyTheme" value="load" formaction="/user/editprofile/preview" class="btn ghost">Preview this base</button>
                        </div>

                        <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 1.25rem 0;" />

                        <div class="section-title">
                            <h3>Custom palette</h3>
                            <span class="section-note">Pick a base, then fine-tune every color.</span>
                        </div>
                        <div class="field-grid">
                            <div class="field">
                                <label>Background</label>
                                <input class="color-input" type="color" name="backgroundColor" value="@background" />
                                <input class="text-input" type="text" name="backgroundColorHex" value="@background" pattern="#?[0-9a-fA-F]{6}" />
                            </div>
                            <div class="field">
                                <label>Text</label>
                                <input class="color-input" type="color" name="fontColor" value="@fontColor" />
                                <input class="text-input" type="text" name="fontColorHex" value="@fontColor" pattern="#?[0-9a-fA-F]{6}" />
                            </div>
                            <div class="field">
                                <label>Accent</label>
                                <input class="color-input" type="color" name="accentColor" value="@accent" />
                                <input class="text-input" type="text" name="accentColorHex" value="@accent" pattern="#?[0-9a-fA-F]{6}" />
                            </div>
                            <div class="field">
                                <label>Border</label>
                                <input class="color-input" type="color" name="borderColor" value="@border" />
                                <input class="text-input" type="text" name="borderColorHex" value="@border" pattern="#?[0-9a-fA-F]{6}" />
                            </div>
                        </div>

                        <div class="field-grid" style="margin-top: 0.75rem;">
                            <div class="field">
                                <label>Button background</label>
                                <input class="color-input" type="color" name="buttonBackgroundColor" value="@btnBg" />
                                <input class="text-input" type="text" name="buttonBackgroundColorHex" value="@btnBg" pattern="#?[0-9a-fA-F]{6}" />
                            </div>
                            <div class="field">
                                <label>Button text</label>
                                <input class="color-input" type="color" name="buttonTextColor" value="@btnText" />
                                <input class="text-input" type="text" name="buttonTextColorHex" value="@btnText" pattern="#?[0-9a-fA-F]{6}" />
                            </div>
                            <div class="field">
                                <label>Button border</label>
                                <input class="color-input" type="color" name="buttonBorderColor" value="@btnBorder" />
                                <input class="text-input" type="text" name="buttonBorderColorHex" value="@btnBorder" pattern="#?[0-9a-fA-F]{6}" />
                                <small>Hover/active shades auto-adjusted.</small>
                            </div>
                        </div>

                        <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 1.25rem 0;" />

                        <div class="section-title">
                            <h3>Layout &amp; typography</h3>
                            <span class="section-note">Keep it readable.</span>
                        </div>
                        <div class="field-grid">
                            <div class="field">
                                <label>Font family</label>
                                <select class="select-input" name="fontFamily">
                                    <option value="system-ui, -apple-system, sans-serif" selected="@(user.FontFamily == "system-ui, -apple-system, sans-serif")">Modern system sans</option>
                                    <option value="'Georgia', serif" selected="@(user.FontFamily == "'Georgia', serif")">Georgia (serif)</option>
                                    <option value="'Trebuchet MS', sans-serif" selected="@(user.FontFamily == "'Trebuchet MS', sans-serif")">Trebuchet (humanist)</option>
                                    <option value="'Courier New', monospace" selected="@(user.FontFamily == "'Courier New', monospace")">Courier (monospace)</option>
                                    <option value="'Comic Sans MS', cursive" selected="@(user.FontFamily == "'Comic Sans MS', cursive")">Comic Sans (playful)</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>Profile layout</label>
                                <select class="select-input" name="profileLayout">
                                    <option value="default" selected="@(user.ProfileLayout == "default")">Standard</option>
                                    <option value="compact" selected="@(user.ProfileLayout == "compact")">Compact</option>
                                    <option value="expanded" selected="@(user.ProfileLayout == "expanded")">Expanded</option>
                                </select>
                            </div>
                        </div>

                        <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 1.25rem 0;" />
                    }

                    <div class="section-title">
                        <h3>About</h3>
                        <span class="section-note">BBCode supported; external links become plain text.</span>
                    </div>
                    <div class="field">
                        <label>About me</label>
                        <textarea class="textarea-tall" name="aboutMe" rows="8">@user.AboutMe</textarea>
                    </div>
                    @await Html.PartialAsync("_BBCodeHelp")

                    <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 1.25rem 0;" />

                    <div class="section-title">
                        <h3>Vendor details</h3>
                        <span class="section-note">Plain text only; no embeds.</span>
                    </div>
                    <div class="field-grid spacious">
                        <div class="field">
                            <label>Shop description</label>
                            <textarea name="vendorShopDescription" rows="4">@user.VendorShopDescription</textarea>
                        </div>
                        <div class="field">
                            <label>Policies</label>
                            <textarea name="vendorPolicies" rows="4">@user.VendorPolicies</textarea>
                        </div>
                        <div class="field">
                            <label>Payments</label>
                            <textarea name="vendorPayments" rows="3">@user.VendorPayments</textarea>
                        </div>
                        <div class="field">
                            <label>External references</label>
                            <textarea name="vendorExternalReferences" rows="3" placeholder="Example: storefront.onion / support email">@user.VendorExternalReferences</textarea>
                        </div>
                    </div>

                    <div class="action-row">
                        <button type="submit" class="btn primary">Save changes</button>
                        <button type="submit" formaction="/user/editprofile/preview" class="btn ghost">Preview changes</button>
                        <a href="/user/@user.Username" class="btn link">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
