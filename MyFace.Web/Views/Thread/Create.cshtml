@model MyFace.Web.Models.CreateThreadViewModel
@{
    ViewData["Title"] = "Create Thread";
}
<div class="thread-test-form">
    <div class="thread-form-lede">
        <div>
            <p class="eyebrow">New thread</p>
            <h1>Launch a visual-first thread</h1>
            <p class="lede">Attach up to two optional images. They become hero tiles on the feed and an immersive gallery inside your post.</p>
        </div>
    </div>

    <form asp-action="Create" method="post" enctype="multipart/form-data">
        <div class="thread-test-grid">
            <div>
                <label asp-for="Title"></label>
                <input asp-for="Title" class="input" placeholder="Thread headline" />
                <span asp-validation-for="Title" class="validation"></span>

                <label asp-for="Content"></label>
                <textarea asp-for="Content" rows="8" class="input" placeholder="Tell the story..."></textarea>
                <span asp-validation-for="Content" class="validation"></span>

                @await Html.PartialAsync("_BBCodeHelp")

                <label class="checkbox-label">
                    <input type="checkbox" asp-for="PostAsAnonymous" /> Post as Anonymous
                </label>
            </div>
            <div>
                <label asp-for="Images">Preview images (optional)</label>
                <div class="lux-upload" aria-describedby="thread-upload-help">
                    <p class="lux-upload-copy">
                        Choose up to two images (PNG, JPG, GIF, or WebP). Larger files are resized on the server; only the first two selections are stored.
                    </p>
                    <input asp-for="Images" id="ThreadImages" type="file"
                           accept="image/png,image/jpeg,image/webp,image/gif"
                           multiple
                           class="lux-file-input"
                           aria-describedby="thread-upload-help" />
                    <p id="thread-upload-help" class="lux-upload-hint">
                        Your browser lists the selected filenames above. Multi-select with Ctrl or Cmd.
                    </p>
                    <span asp-validation-for="Images" class="validation"></span>
                </div>
            </div>
        </div>

        <div class="form-captcha">
            @{
                var captchaHelpText = "Read the phrase above, then answer the requested word position or simple math. Case insensitive, no punctuation.";
                var captchaContext = ViewBag.CaptchaContext as string ?? string.Empty;
                var captchaQuestion = ViewBag.CaptchaQuestion as string ?? string.Empty;
            }
            <div class="captcha-box">
                <div class="captcha-code">@Html.Raw(captchaContext)</div>
                <label class="captcha-question" for="captchaAnswer">@captchaQuestion</label>
                <input name="captchaAnswer" id="captchaAnswer" class="input captcha-input" required autocomplete="off" />
                @if (ViewData.ModelState.TryGetValue("Captcha", out var captchaState) && (captchaState?.Errors.Count ?? 0) > 0)
                {
                    <span class="validation">@captchaState!.Errors[0].ErrorMessage</span>
                }
                <button type="button"
                        class="captcha-help"
                        title="@captchaHelpText"
                        aria-label="How to complete this captcha">?</button>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="button button-primary">Publish thread</button>
            <a href="@Url.Action("Index", "Thread")" class="button button-secondary">Cancel</a>
        </div>
    </form>
</div>
