@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@model List<MyFace.Core.Entities.OnionStatus>
@{
    ViewData["Title"] = "Onion Monitor";
    var username = User.Identity?.Name;
    var admins = Configuration.GetSection("Admins").Get<string[]>() ?? Array.Empty<string>();
    var mods = Configuration.GetSection("Moderators").Get<string[]>() ?? Array.Empty<string>();
    var isAdminOrMod = !string.IsNullOrEmpty(username) && (admins.Contains(username) || mods.Contains(username));
}
<h1>Onion Monitor</h1>
<div class="monitor-actions">
    @if (isAdminOrMod)
    {
        <a href="@Url.Action("Add")" class="button">‚ûï Add Service</a>
        <form asp-action="CheckAll" method="post" style="display:inline">
            <button class="button" type="submit">üîÑ Check All</button>
        </form>
    }
    <a href="@Url.Action("Monitor","Rss")" class="button">üì° RSS Feed</a>
</div>

<div class="monitor-list">
    @foreach (var monitor in Model)
    {
        <div class="monitor-card">
            <div class="monitor-header">
                <div class="monitor-title">
                    <h3>@monitor.Name</h3>
                    <p class="monitor-description">@monitor.Description</p>
                    <a href="@monitor.OnionUrl" class="monitor-link">üîó @monitor.OnionUrl</a>
                </div>
                <div class="monitor-status">
                    @if (monitor.Status == "Online")
                    {
                        <span class="status-badge status-online">‚óè @monitor.Status</span>
                    }
                    else if (monitor.Status == "DEGRADED")
                    {
                        <span class="status-badge status-degraded">‚óè @monitor.Status</span>
                    }
                    else
                    {
                        <span class="status-badge status-offline">‚óè @monitor.Status</span>
                    }
                </div>
            </div>
            <div class="monitor-stats">
                <div class="stat">
                    <span class="stat-label">Reachability:</span>
                    <span class="stat-value">@monitor.ReachableAttempts/@monitor.TotalAttempts</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Avg Latency:</span>
                    <span class="stat-value">@(monitor.AverageLatency?.ToString("F0") ?? "-") ms</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Last Checked:</span>
                    <span class="stat-value">@monitor.LastChecked?.ToString("u")</span>
                </div>
            </div>
            @if (isAdminOrMod)
            {
                <div class="monitor-actions-row">
                    <form asp-action="Check" method="post" style="display:inline">
                        <input type="hidden" name="id" value="@monitor.Id" />
                        <button class="button button-small" type="submit">üîç Check Now</button>
                    </form>
                    <a href="@Url.Action("Edit", new { id = monitor.Id })" class="button button-small">‚úèÔ∏è Edit</a>
                    <form asp-action="Remove" method="post" style="display:inline">
                        <input type="hidden" name="id" value="@monitor.Id" />
                        <button class="button button-small button-danger" type="submit" onclick="return confirm('Remove this service?')">üóëÔ∏è Remove</button>
                    </form>
                </div>
            }
        </div>
    }
</div>
