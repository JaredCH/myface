@model MyFace.Web.Models.ChatSectionModel

<div class="chat-section">
    <div class="irc-window">
        <div class="irc-window-header">
            <div>
                <div class="irc-window-room">#@Model.Room</div>
                <p class="chat-note">@Model.Description</p>
            </div>
            <div class="irc-status-pill @(Model.Paused ? "paused" : "live")">@(Model.Paused ? "paused" : "live")</div>
        </div>

        @if (!string.IsNullOrEmpty(Model.FlashInfo))
        {
            <div class="flash info">@Model.FlashInfo</div>
        }
        @if (!string.IsNullOrEmpty(Model.FlashError))
        {
            <div class="flash error">@Model.FlashError</div>
        }

        <div class="irc-window-body">
            @if (!Model.UserCanView)
            {
                <p class="chat-note">You do not have access to view this room.</p>
            }
            else
            {
                <div class="irc-viewport-wrap">
                    <iframe class="irc-viewport" src="@Url.Action("Messages", "Chat", new { room = Model.Room })" title="@Model.Title chat" loading="lazy"></iframe>
                </div>
            }
        </div>

        <div class="irc-window-compose">
            @if (Model.Paused)
            {
                <p class="chat-note">Chat is paused. Messages remain visible but posting is disabled.</p>
            }
            else if (Model.CanPost && Model.UserCanView)
            {
                <form class="irc-compose-form" method="post" asp-action="Send" asp-controller="Chat">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="room" value="@Model.Room" />
                    <label class="sr-only" for="msg-@Model.Room">Message</label>
                    <input class="irc-input" type="text" name="content" id="msg-@Model.Room" maxlength="199" placeholder="Message (199 chars, no HTML)" />
                    <button type="submit" class="button irc-send">Send</button>
                </form>
            }
            else if (Model.UserCanView && !Model.CanPost)
            {
                <p class="chat-note">Posting is limited in this room.</p>
            }
        </div>
    </div>

    @if (Model.IsModerator)
    {
        <div class="irc-mod-panel" aria-label="Moderator controls for #@Model.Room">
            <div class="irc-mod-panel-head">
                <span class="irc-mod-panel-title">Moderator controls</span>
                <span class="irc-mod-panel-room">#@Model.Room</span>
            </div>
            <div class="irc-mod-tools">
                <form class="single-action" data-label="Pause room" method="post" asp-action="Pause" asp-controller="Chat">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="room" value="@Model.Room" />
                    <button type="submit" class="button">Pause</button>
                </form>
                <form class="single-action" data-label="Resume room" method="post" asp-action="Resume" asp-controller="Chat">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="room" value="@Model.Room" />
                    <button type="submit" class="button">Resume</button>
                </form>
                <form data-label="Delete message" method="post" asp-action="Delete" asp-controller="Chat">
                    @Html.AntiForgeryToken()
                    <input type="number" name="id" placeholder="Message id" min="1" />
                    <button type="submit" class="button">Delete</button>
                </form>
                <form data-label="Mute user" method="post" asp-action="Mute" asp-controller="Chat">
                    @Html.AntiForgeryToken()
                    <input type="text" name="username" placeholder="Username" />
                    <input type="number" name="minutes" value="60" min="1" max="10080" />
                    <button type="submit" class="button">Mute</button>
                </form>
                <p class="chat-note">Moderation tools: message ids appear in the feed (#123). Mute duration is in minutes.</p>
            </div>
        </div>
    }
</div>
